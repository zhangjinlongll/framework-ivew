(function(name,definition){var hasDefine=typeof define==="function",hasExports=typeof module!=="undefined"&&module.exports;if(hasDefine){define(definition)}else{if(hasExports){module.exports=definition()}else{this[name]=definition()}}})("da",function(){var da={store:{storeVer:"0.0.6",storePage:"LOGACPAGE",storeClick:"LOGACCLIK",storeReqErr:"LOGACRERR",storeCodeErr:"LOGACCERR",sendUrl:"",selector:"input",acRange:["text","tel"],maxDays:5,useStorage:false,},util:{isNullOrEmpty:function(obj){return(obj!==0||obj!=="0")&&(obj===null||obj===undefined||obj===""||obj==="null"||typeof obj==="undefined")},isJson:function(str){if(typeof str=="string"){try{var obj=JSON.parse(str);if(typeof obj=="object"&&obj){return true}else{return false}}catch(e){return false}}else{if(typeof str=="object"){return true}else{return false}}},setCookie:function(name,value,Day){if(da.store.useStorage){window.localStorage.setItem(name,value)}else{if(!Day){Day=da.store.maxDays}var exp=new Date();exp.setTime(exp.getTime()+Day*24*60*60000);document.cookie=name+"="+encodeURIComponent(value)+";expires="+exp.toUTCString()+";path=/"}},getCookie:function(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");if(!name){return null}if(da.store.useStorage){return window.localStorage.getItem(name)}else{if(arr=document.cookie.match(reg)){return(decodeURIComponent(arr[2]))}else{return null}}},delCookie:function(name){if(da.store.useStorage){window.localStorage.removeItem(name)}else{this.setCookie(name,"",-1)}},getTimeStr:function(){var date=new Date();var now=date.getFullYear()+"/";now+=(date.getMonth()+1)+"/";now+=date.getDate()+" ";now+=date.getHours()+":";now+=date.getMinutes()+":";now+=date.getSeconds()+"";return now},getTimestamp:function(){return new Date().getTime()},getOS:function(){var sUserAgent=navigator.userAgent;var isWin=(navigator.platform=="Win32")||(navigator.platform=="Windows");var isMac=(navigator.platform=="Mac68K")||(navigator.platform=="MacPPC")||(navigator.platform=="Macintosh")||(navigator.platform=="MacIntel");if(isMac){return"Mac"}var isUnix=(navigator.platform=="X11")&&!isWin&&!isMac;if(isUnix){return"Unix"}var isLinux=(String(navigator.platform).indexOf("Linux")>-1);if(isLinux){return"Linux"}if(isWin){var isWin2K=sUserAgent.indexOf("Windows NT 5.0")>-1||sUserAgent.indexOf("Windows 2000")>-1;if(isWin2K){return"Win2000"}var isWinXP=sUserAgent.indexOf("Windows NT 5.1")>-1||sUserAgent.indexOf("Windows XP")>-1;if(isWinXP){return"WinXP"}var isWin2003=sUserAgent.indexOf("Windows NT 5.2")>-1||sUserAgent.indexOf("Windows 2003")>-1;if(isWin2003){return"Win2003"}var isWinVista=sUserAgent.indexOf("Windows NT 6.0")>-1||sUserAgent.indexOf("Windows Vista")>-1;if(isWinVista){return"WinVista"}var isWin7=sUserAgent.indexOf("Windows NT 6.1")>-1||sUserAgent.indexOf("Windows 7")>-1;if(isWin7){return"Win7"}var isWin8=sUserAgent.indexOf("Windows NT 6.2")>-1||sUserAgent.indexOf("Windows 8")>-1;if(isWin8){return"Win8"}var isWin10=sUserAgent.indexOf("Windows NT 10.0")>-1||sUserAgent.indexOf("Windows 10")>-1;if(isWin10){return"Win10"}}return"other"},getPlatform:function(){var _platform="S1";var client_info=navigator.userAgent.toLowerCase();if(!!client_info.match(/ipad|iphone|android|blackberry|windows phone|webos/i)){if(!!client_info.match(/micromessenger/i)){_platform="S3"}else{_platform="S2"}}return _platform},getUserinfo:function(){return window.localStorage.aijiaUserdata?JSON.parse(window.localStorage.aijiaUserdata):{"sessionId":"","userId":""}},getDisplay:function(){return screen.width+"x"+screen.height},getUid:function(){return this.getUserinfo().userId},getSessionId:function(){return this.getUserinfo().sessionId},getReferrer:function(){return document.referrer},getCurpageurl:function(){return location.href},getSetType:function(str){var setType="";var metaTags=document.getElementsByTagName("meta");for(var i=0;i<metaTags.length;i++){if(metaTags[i].getAttribute("name")==str){setType=metaTags[i].getAttribute("content");break}}return setType},getLogType:function(num){var logType="";switch(parseInt(num)){case 10000:logType="KO1O1001";break;case 20000:logType="K0102001";break;case 30000:logType="K0201001";break;case 40000:logType="K0202001";break;case 50000:logType="k0301001";break;case 60000:logType="k0401001";break;case 70000:logType="K0501001";default:logType="KO1O1001"}return logType},getAccessKey:function(){return"e71dc0264f31815df587d7ede49a75aa"},getHpc:function(){var os,hpc,er3k,rhma,tu,rn5=navigator["userAgent"]["toLowerCase"]();var mu37=function(){var hpc,w=ere||this;hpc=(typeof window["onhelp"]==object)?"IExplorer":(typeof window["chrome"]==object)?"Chrome":(typeof window["InstallTrigger"]==object)?"Firefox":(typeof window["opera"]==object)?Opera:"An unknown browser";return hpc};var gr6=0;var n1=0;do{if(n1){tu=="-1"?tu="an unknown version":tu=tu["split"](".")[0];continue}tu=(er3k=rn5["match"](/maxthon[\/ ]([\d.]+)/i))?(hpc="Maxthon",er3k[1]):(er3k=rn5["match"](/msie.*360se/i))?(hpc="360SE","-1"):(er3k=rn5["match"](/msie.*360ee/i))?(hpc="360EE","-1"):(er3k=rn5["match"](/msie.*alibrowser ([\d.]+)/i))?(hpc="Alibrowser",er3k[1]):(er3k=rn5["match"](/chrome.*taobrowser\/([\d.]+)/i))?(hpc="Taobrowser",er3k[1]):(er3k=rn5["match"](/se ([\d]+.[\w]*) metasr ([\d.]+)/i))?(hpc="Sogou",er3k[1]):(er3k=rn5["match"](/msie.*qihu theworld/i))?(hpc="Theworld","-1"):(er3k=rn5["match"](/tencenttraveler ([\d.]+)/i))?(hpc="TencentTraveler",er3k[1]):(er3k=rn5["match"](/qqbrowser\/([\d.]+)/i))?(hpc="QQBrowser",er3k[1]):(er3k=rn5["match"](/msie ([\d.]+)/i))?(hpc="IExplorer",er3k[1]):(er3k=rn5["match"](/firefox\/([\d.]+)/i))?(hpc="Firefox",er3k[1]):(er3k=rn5["match"](/Opera.+Version\/([\d.]+)/i))?(hpc="Opera",er3k[1]):(er3k=rn5["match"](/opr\/([\d.]+)/i))?(hpc="Opera",er3k[1]):(er3k=rn5["match"](/version\/([\d.]+).*safari/i))?(hpc="Safari",er3k[1]):(er3k=rn5["match"](/chrome\/([\d.]+)/i))?(hpc="Chrome",er3k[1]):(rhma=mu37(),hpc=rhma,-1);
n1=++gr6+gr6++}while(--n1);return[hpc,tu]},setGetUrl:function(){if(location.href.indexOf(".dev.")!==-1){da.store.sendUrl="http://gringotts.dev.ihomefnt.org/kv/v.gif"}else{if(location.href.indexOf(".sit.")!==-1){da.store.sendUrl="http://gringotts.sit.ihomefnt.org/kv/v.gif"}else{da.store.sendUrl="//gringotts.ihomefnt.com/kv/v.gif"}}}},log:function(params){this.util.setGetUrl();var logData={ak:params.ak?params.ak:this.util.getAccessKey(),version:params.version?params.version:this.store.storeVer,frontTime:params.frontTime?params.frontTime:this.util.getTimestamp(),bizType:params.bizType?params.bizType:this.util.getSetType("bizType"),logType:params.logType?params.logType:this.util.getLogType(70000),pageId:params.pageId?params.pageId:this.util.getSetType("pageId"),platform:this.util.getPlatform(),curPageUrl:params.curPageUrl?params.curPageUrl:location.href,log:params.log?params.log:""};this.report(logData)},init:function(){this.util.setGetUrl();this.store.useStorage=(typeof window.localStorage!="undefined");var _this=this,nowStr=this.util.getTimeStr(),codeErrData=this.getAc2Type(this.store.storeCodeErr),clickAcData=this.getAc2Type(this.store.storeClick),reqErrAcData=this.getAc2Type(this.store.storeReqErr),pageAcData=this.getAc2Type(this.store.storePage);this.bindAjaxHook();this.bindCodeHook();this.bindPageLoad();if(/iphone|ipad|ipod/i.test(window.navigator.userAgent)){var elements=document.getElementsByTagName("body")[0].childNodes;for(var z=0,length=elements.length;z<length;z++){elements[z].addEventListener("click",function(){})}}document.addEventListener("click",function(e){var event=window.event||e;var target=event.srcElement?event.srcElement:event.target;_this.getACBtarget(target)})},bindAjaxHook:function(){var _this=this;function ajaxEventTrigger(event){var ajaxEvent=new CustomEvent(event,{detail:this});window.dispatchEvent(ajaxEvent);if(this.status&&event==="ajaxLoadEnd"&&this.readyState===4&&_this.util.isJson(this.response)){da.setAjErrAc(this)}}var oldXHR=window.XMLHttpRequest;function newXHR(){var realXHR=new oldXHR();realXHR.addEventListener("abort",function(){ajaxEventTrigger.call(this,"ajaxAbort")},false);realXHR.addEventListener("error",function(){ajaxEventTrigger.call(this,"ajaxError")},false);realXHR.addEventListener("load",function(){ajaxEventTrigger.call(this,"ajaxLoad")},false);realXHR.addEventListener("loadstart",function(){ajaxEventTrigger.call(this,"ajaxLoadStart")},false);realXHR.addEventListener("progress",function(){ajaxEventTrigger.call(this,"ajaxProgress")},false);realXHR.addEventListener("timeout",function(){ajaxEventTrigger.call(this,"ajaxTimeout")},false);realXHR.addEventListener("loadend",function(){ajaxEventTrigger.call(this,"ajaxLoadEnd")},false);realXHR.addEventListener("readystatechange",function(){ajaxEventTrigger.call(this,"ajaxReadyStateChange")},false);realXHR.addEventListener("send",function(){ajaxEventTrigger.call(this,"send")},false);return realXHR}window.XMLHttpRequest=newXHR;if(typeof window.CustomEvent==="function"){return false}function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent},bindCodeHook:function(){var _this=this;window.onerror=function(msg,url,line,col,err){if(_this.util.isNullOrEmpty(url)){return true}col=col||(window.event&&window.event.errorCharacter)||0;var codeErrData={ak:_this.util.getAccessKey(),version:_this.store.storeVer,frontTime:_this.util.getTimestamp(),bizType:_this.util.getSetType("bizType"),pageId:_this.util.getSetType("pageId"),logType:_this.util.getLogType(60000),platform:_this.util.getPlatform(),os:_this.util.getOS(),explorer:_this.util.getHpc()[0],vexplorer:_this.util.getHpc()[1],session:_this.util.getSessionId(),uid:_this.util.getUid(),curpageurl:_this.util.getCurpageurl(),msg:msg,line:line,col:col};if(!!err&&!!err.stack){codeErrData.err=err.stack.toString()}else{if(!!arguments.callee){var errmsg=[];var f=arguments.callee.caller,c=3;while(f&&(--c>0)){errmsg.push(f.toString());if(f===f.caller){break}f=f.caller}errmsg=errmsg.join(",");codeErrData.err=errmsg}else{codeErrData.err=""}}da.setCodeErrAc(codeErrData);_this.report(codeErrData)}},setPerformanceAc:function(){var _this=this;if(!!window.performance){var _PerforMance=window.performance;var _Timing=_PerforMance.timing;var storeString=_this.util.getCookie(_this.store.storePage);var ACPdata=_this.util.isNullOrEmpty(storeString)?[]:JSON.parse(storeString);if(_Timing){var loadAcData={};setTimeout(function(){loadAcData.DNS=_Timing.domainLookupEnd-_Timing.domainLookupStart;loadAcData.TCP=_Timing.connectEnd-_Timing.connectStart;loadAcData.WT=_Timing.responseStart-_Timing.navigationStart;loadAcData.DR=_Timing.domContentLoadedEventEnd-_Timing.navigationStart;loadAcData.ONL=_Timing.loadEventEnd-_Timing.navigationStart;loadAcData.ALLRT=_Timing.responseEnd-_Timing.responseStart;
loadAcData.PRDOM=_Timing.domComplete-_Timing.domInteractive;loadAcData.FXHR=_Timing.fetchStart-_Timing.navigationStart;var loadData={ak:_this.util.getAccessKey(),version:_this.store.storeVer,frontTime:_this.util.getTimestamp(),bizType:_this.util.getSetType("bizType"),logType:_this.util.getLogType(),platform:_this.util.getPlatform(),session:_this.util.getSessionId(),uid:_this.util.getUid(),referurl:_this.util.getReferrer(),curpageurl:_this.util.getCurpageurl(),os:_this.util.getOS(),explorer:_this.util.getHpc()[0],vexplorer:_this.util.getHpc()[1],display:_this.util.getDisplay(),pageId:_this.util.getSetType("pageId"),log:"",wt:loadAcData.WT,onl:loadAcData.ONL,allrt:loadAcData.ALLRT};_this.report(loadData);ACPdata.push(loadData);_this.util.setCookie(_this.store.storePage,JSON.stringify(ACPdata))},200)}}else{var loadData={ak:_this.util.getAccessKey(),version:_this.store.storeVer,frontTime:_this.util.getTimestamp(),bizType:_this.util.getSetType("bizType"),logType:_this.util.getLogType(),platform:_this.util.getPlatform(),session:_this.util.getSessionId(),uid:_this.util.getUid(),referurl:_this.util.getReferrer(),curpageurl:_this.util.getCurpageurl(),os:_this.util.getOS(),explorer:_this.util.getHpc()[0],vexplorer:_this.util.getHpc()[1],display:_this.util.getDisplay(),pageId:_this.util.getSetType("pageId"),log:"",wt:"",onl:""};_this.report(loadData);ACPdata.push(loadData);_this.util.setCookie(_this.store.storePage,JSON.stringify(ACPdata))}},bindPageLoad:function(){var _this=this;window.onload=function(event){_this.setPerformanceAc()}},setCodeErrAc:function(data){var storeString=this.util.getCookie(this.store.storeCodeErr);var ACCEdata=this.util.isNullOrEmpty(storeString)?[]:JSON.parse(storeString);ACCEdata.push(data);this.util.setCookie(this.store.storeCodeErr,JSON.stringify(ACCEdata))},setAjErrAc:function(xhr){var storeString=this.util.getCookie(this.store.storeReqErr);var ACEdata=this.util.isNullOrEmpty(storeString)?[]:JSON.parse(storeString);var nowStr=this.util.getTimeStr();var _logType="";if(xhr.status===200){_logType=this.util.getLogType(40000)}else{_logType=this.util.getLogType(50000)}var ErrorData={ak:this.util.getAccessKey(),version:this.store.storeVer,frontTime:this.util.getTimestamp(),bizType:this.util.getSetType("bizType"),logType:_logType,pageId:this.util.getSetType("pageId"),platform:this.util.getPlatform(),session:this.util.getSessionId(),uid:this.util.getUid(),requrl:xhr.responseURL,status:xhr.status,statusText:xhr.statusText,};ACEdata.push(ErrorData);this.util.setCookie(this.store.storeReqErr,JSON.stringify(ACEdata));this.report(ErrorData)},setClickAc:function(e){var storeString=this.util.getCookie(this.store.storeClick);var ACBdata=this.util.isNullOrEmpty(storeString)?[]:JSON.parse(storeString);if(!(e.attributes["event-param"]||e.parentNode.attributes["event-param"])){return false}var paramStr=e.attributes["event-param"]?e.attributes["event-param"].value:"";if(!paramStr){paramStr=e.parentNode.attributes["event-param"]?e.parentNode.attributes["event-param"].value:""}var paramArr=paramStr?paramStr.split("|"):["","",""];var clickData={ak:this.util.getAccessKey(),version:this.store.storeVer,frontTime:this.util.getTimestamp(),bizType:this.util.getSetType("bizType"),logType:this.util.getLogType(paramArr[0]),platform:this.util.getPlatform(),session:this.util.getSessionId(),uid:this.util.getUid(),referurl:this.util.getReferrer(),curpageurl:this.util.getCurpageurl(),os:this.util.getOS(),display:this.util.getDisplay(),pageId:this.util.getSetType("pageId"),viewid:paramArr[1]?paramArr[1]:"",log:paramArr[2]?paramArr[2]:""};this.report(clickData);ACBdata.push(clickData);this.util.setCookie(this.store.storeClick,JSON.stringify(ACBdata))},getAc2Type:function(type){var storeArr=[];var storeString=this.util.getCookie(type);if(!this.util.isNullOrEmpty(storeString)){storeArr=JSON.parse(storeString)}this.util.delCookie(type);return storeArr},getACBtarget:function(node,length){if(this.util.isNullOrEmpty(length)){length=0}if(!this.util.isNullOrEmpty(node)){var parentNode=node&&node.parentNode;if(Object.prototype.toString.call(parentNode)!==Object.prototype.toString.call(document)&&(node.attributes["event-param"]||node.parentNode.attributes["event-param"])){this.setClickAc(node)}else{}}},report:function(data){var url=this.store.sendUrl;var defaultUrl="/img";url=url||defaultUrl;url=url.replace(/^null/,defaultUrl);if(!url||!data){return}var image=document.createElement("img");var items=[];for(var key in data){if(data[key]||data[key]===0){items.push(key+"="+encodeURIComponent(data[key]))}else{items.push(key)}}image.onload=image.onerror=function(){image=image.onload=image.onerror=null};image.src=url+(url.indexOf("?")<0?"?":"&")+items.join("&")}};return da});
